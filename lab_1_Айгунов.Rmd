---
title: 'Лабораторная работа №1: Предварительный анализ данных'
author: "Айгунов Гаджи-Мурад"
date: "27 10 2020"
output: word_document
---


```{r echo=FALSE ,include=FALSE}
library("Hmisc")
library("corrplot")
library("knitr")
library("nortest")
knitr::opts_chunk$set(echo = FALSE)
```
*Раздел I*

В этом разделе собираются данные по социально-экономическим показателям в регионах РФ и изучаются их взаимосвязи.


**Необходимо построить:**
*Коробчатые диаграммы на одном полотне;

*Таблицу со статистикой теста Шапиро-Уилка на нормальность;

*Точечные графики взаимного разброса;

*Графическое представление корреляционной матрицы.

Обозначения количественных показателей:

*X1 - Валовой региональный продукт 2017г;

*X2 - Инвестиции в основной капитал 2016г;

*X3 - Расходы консолидированных бюджетов субъектов Российской Федерации: на национальную экономику 2016г;

*X4 - Использование информационных и коммуникационных технологий в организациях: персональные компьютеры 2016г;

*X5 - Внутренние затраты на научные исследования и разработки 2016г;

```{r}
#1 Импорт
DF <- read.csv2("Data.csv",
                stringsAsFactors = F)

```

Файл с данными содержит `r nrow(DF)` строк и `r ncol(DF)` столбцов.

```{r}
DF$REG <- factor(DF$REG) #Регионы-факторы
DF <- na.omit(DF) #Удаляем пустые ячейки

```

*Описательная статистика*

```{r}
# среднее
mns <- round(apply(DF[, 2:6], 2, mean), 1)
mns
# стандартное откл
sds <- round(apply(DF[, 2:5], 2, sd), 1)
sds
# коэффициенты вариации
coef.vars <- round(sds/mns*100, 1)
coef.vars
# делаем свою таблицу только с нужными статистиками 
# по количественным показателям: среднее, СКО, коэффициент вариации
smm <- rbind(mns, sds, coef.vars)
row.names(smm) <- c('Среднее', 'Стандартное отклонение',
                    'Коэффициент вариации, %')

smm

```
**Вывод:** показатели неоднородны. 

*Анализ распределения данных*


```{r}
#Построим коробчатую диаграмму на одном полотне.
par(mfrow = c(1,5)) #полотно на 5 частей
par(oma = c(0, 0, 1.5, 0)) #внешние поля общего полотна
par(mar = c(4, 4, 0.5, 0.5)) # внутренние поля каждого графика
#цикл по столбцам
for (i in 2:6) {
 x <- DF[,i]
 boxplot(x,
          freq = F,
          col = "royalblue",
          main = ""
          )
}
# общий заголовок для всех графиков
title(main = "Коробчатые диаграммы для всех показателей", 
     outer = TRUE, cex = 1.5)
#Настройки полотна обратно
par(mfrow = c(1, 1))

```

*Тест Шапиро-Уилка на нормальность распределения*

```{r}
# тест Шапиро-Уилка на нормальность распределения
# применяем ко всем столбцам и вытаскиваем только тестовую статистику
W <- sapply(DF[, 2:6], function(x) {
  round(shapiro.test(x)$statistic, 4)
})
p <- sapply(DF[, 2:6], function(x) {
  round(shapiro.test(x)$p.value,4)
})
table <- rbind(W, p)
rownames(table) <- c("Статистика теста","Критическое значение")
table

```
**Вывод:** На уровне значимости 0,05 мы можем отвергнуть нулевую гиппотезу о нормальности закона распределения у всех показателей, поскольку все  p-значения меньше 0,05.

*Графики разброса*

```{r}
# Графики разброса
pairs(DF[, -1], # фрейм без первого столбца-фактора
      pch = 21, # тип символов для точек
      col = rgb(0, 0, 1, alpha = 0,4), # цвет заливки точек
      bg = rgb(0, 0, 1, alpha = 0.4), # цвет границы точек
      cex = 1.1) # масштаб символов для точек
```

*Корреляционная матрица*

```{r}
# Коэффициенты Пирсона с Р-значениями
r.corr <- rcorr(as.matrix(DF[, -1]))
r.corr
# Визуализация корреляционной матрицы
matrix.cor <- r.corr$r
matrix.cor
# Сохраняем p-значения
matrix.p <- r.corr$P
matrix.p
# Изображаем матрицу графически
corrplot(matrix.cor,
         method = "color",
         )

```


**Вывод:** Значимая взаимосвязь наблюдается между переменными X1, X2, X3, X5.

*Раздел II*
В этом разделе необходимо прологарифмировать данные из первого раздела и провести с новыми данными те же махинации.

*Описательная статистика логарифмированных данных:*

```{r}
DF1 <- DF
DF1$X1 <- log(DF$X1)
DF1$X2 <- log(DF$X2)
DF1$X3 <- log(DF$X3)
DF1$X4 <- log(DF$X4)
DF1$X5 <- log(DF$X5)
#ручной расчет
mns1 <- round(apply(DF1[, -1],2,mean),3)
#  стандартные отклонения
sds1 <- round(apply(DF1[, -1], 2, sd), 3)
#  коэффициенты вариации
coef.vars1 <- round(sds1 / mns1 * 100, 3)
# делаем свою таблицу только с нужными статистиками 
#  по количественным показателям: среднее, СКО, коэффициент вариации
smm1 <- rbind(mns1, sds1, coef.vars1)
# названия статистик -- заголовки строк
row.names(smm1) <- c("Среднее", "Стандартное отклонение",
                     "Коэффициент вариации, %")
smm1

```

**Вывод:** показатели не полностью однородны.

*Анализ распределения*

Построим коробчатые диаграммы.

```{r}
par(mfrow = c(1,5)) #полотно на 5 частей
par(oma = c(0, 0, 1.5, 0))
par(mar = c(4, 4, 0.5, 0.5))
#цикл по столбцам
for (i in 2:6) {
  x <- DF1[,i]
  boxplot(x,
          col = "royalblue",
          freq = F,
          main = "")
}
# общий заголовок для всех графиков
title(main = "Коробчатые диаграммы для всех показателей", 
      outer = TRUE, cex = 1)
#Настройки полотна обратно
par(mfrow = c(1, 1))

```

*Тест Шапиро-Уилка на нормальность распределения.*

```{r}
# тест Шапиро-Уилка на нормальность распределения
# применяем ко всем столбцам с помощью apply()
apply(DF1[,2:6], 2, shapiro.test)
# применяем ко всем столбцам и вытаскиваем только тестовую статистику
W1 <- sapply(DF1[, 2:6], function(x) {
  round(shapiro.test(x)$statistic, 4)
})
p1 <- sapply(DF1[, 2:6], function(x) {
  round(shapiro.test(x)$p.value,4)
})
table1 <- rbind(W, p)
rownames(table1) <- c("Статистика теста","Критическое значение")
table1

```

**Вывод:** На уровне значимости 0.05 мы отвергаем гипотезу о нормальности распределения показателей.

*Графики разброса*

```{r}
#Графики разброса
pairs(DF1[, -1],
      pch = 21,
      col = rgb(0, 0, 1, alpha = 0,4),
      bg = rgb(0, 0, 1, alpha = 0.4),
      cex = 1.1)

```


*Корреляционная матрица*

```{r}
#коэффициенты Пирсона с Р-значениями
r.corr1 <- rcorr(as.matrix(DF1[, -1]))
r.corr1
#Визуализация корреляционной матрицы
matrix.cor1 <- r.corr1$r
matrix.cor1
#сохраняем p-значения
matrix.p1 <- r.corr1$P
matrix.p1
# изображаем матрицу графически
corrplot(matrix.cor,
         method = "color",
)


```

**Вывод:** Значимая взаимосвязь наблюдается между переменными X1, X2, X3, X5.

```{r}
# сохраняем нужные объекты в файл
save(list = c('DF', 'DF1'), file = 'lab1_Айгунов.RData')
```